/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { moveItemInArray } from '@angular/cdk/drag-drop';
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ContentChild, EventEmitter, Input, Output, TemplateRef, } from '@angular/core';
import { from, Subject } from 'rxjs';
import { flatMap, groupBy, reduce } from 'rxjs/operators';
import { Event } from '../..';
import { ConfigService } from '../../services/config-service';
import { UtilsService } from '../../services/utils-service';
import { API } from '../../model/api';
/**
 * @record
 */
function RowContextMenuPosition() { }
if (false) {
    /** @type {?} */
    RowContextMenuPosition.prototype.top;
    /** @type {?} */
    RowContextMenuPosition.prototype.left;
    /** @type {?} */
    RowContextMenuPosition.prototype.value;
}
var BaseComponent = /** @class */ (function () {
    function BaseComponent(cdr) {
        this.cdr = cdr;
        this.grouped = [];
        this.menuActive = false;
        this.isSelected = false;
        this.page = 1;
        this.count = null;
        this.rowContextMenuPosition = {
            top: null,
            left: null,
            value: null,
        };
        this.sortBy = {
            key: '',
            order: 'asc',
        };
        this.sortByIcon = {
            key: '',
            order: 'asc',
        };
        this.selectedDetailsTemplateRowId = new Set();
        this.loadingHeight = '30px';
        this.onSelectAllBinded = this.onSelectAll.bind(this);
        this.event = new EventEmitter();
        this.id = UtilsService.randomId();
    }
    Object.defineProperty(BaseComponent.prototype, "configuration", {
        get: /**
         * @return {?}
         */
        function () {
            return this.config;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.config = value;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    BaseComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        if (!this.columns) {
            console.error('[columns] property required!');
        }
        if (this.configuration) {
            ConfigService.config = this.configuration;
        }
        this.config = ConfigService.config;
        if (this.api) {
            this.bindApi();
        }
        this.limit = this.config.rows;
        if (this.groupRowsBy) {
            this.doGroupRows();
        }
        this.doDecodePersistedState();
    };
    /**
     * @return {?}
     */
    BaseComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.cdr.detectChanges();
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    BaseComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        /** @type {?} */
        var data = changes.data;
        /** @type {?} */
        var pagination = changes.pagination;
        /** @type {?} */
        var groupRowsBy = changes.groupRowsBy;
        this.toggleRowIndex = changes.toggleRowIndex;
        if (data && data.currentValue) {
            this.doApplyData(data);
        }
        if (pagination && pagination.currentValue) {
            this.count = pagination.currentValue.count;
        }
        if (groupRowsBy && groupRowsBy.currentValue) {
            this.doGroupRows();
        }
        if (this.toggleRowIndex && this.toggleRowIndex.currentValue) {
            /** @type {?} */
            var row = this.toggleRowIndex.currentValue;
            this.collapseRow(row.index);
        }
    };
    /**
     * @param {?} column
     * @return {?}
     */
    BaseComponent.prototype.isOrderEnabled = /**
     * @param {?} column
     * @return {?}
     */
    function (column) {
        /** @type {?} */
        var columnOrderEnabled = column.orderEnabled === undefined ? true : !!column.orderEnabled;
        return ConfigService.config.orderEnabled && columnOrderEnabled;
    };
    /**
     * @param {?} column
     * @return {?}
     */
    BaseComponent.prototype.orderBy = /**
     * @param {?} column
     * @return {?}
     */
    function (column) {
        if (typeof column.orderEnabled !== 'undefined' && !column.orderEnabled) {
            return;
        }
        /** @type {?} */
        var key = column.key;
        if (!ConfigService.config.orderEnabled || key === '') {
            return;
        }
        this.sortByIcon.key = key;
        if (this.sortByIcon.order === 'asc') {
            this.sortByIcon.order = 'desc';
        }
        else {
            this.sortByIcon.order = 'asc';
        }
        if (!ConfigService.config.orderEventOnly && !column.orderEventOnly) {
            this.sortBy.key = this.sortByIcon.key;
            this.sortBy.order = this.sortByIcon.order;
        }
        else {
            this.sortBy.key = '';
            this.sortBy.order = '';
        }
        if (!ConfigService.config.serverPagination) {
            this.data = tslib_1.__spread(this.data);
        }
        /** @type {?} */
        var value = {
            key: key,
            order: this.sortByIcon.order,
        };
        this.emitEvent(Event.onOrder, value);
    };
    /**
     * @param {?} $event
     * @param {?} row
     * @param {?} key
     * @param {?} colIndex
     * @param {?} rowIndex
     * @return {?}
     */
    BaseComponent.prototype.onClick = /**
     * @param {?} $event
     * @param {?} row
     * @param {?} key
     * @param {?} colIndex
     * @param {?} rowIndex
     * @return {?}
     */
    function ($event, row, key, colIndex, rowIndex) {
        if (ConfigService.config.selectRow) {
            this.selectedRow = rowIndex;
        }
        if (ConfigService.config.selectCol && colIndex) {
            this.selectedCol = colIndex;
        }
        if (ConfigService.config.selectCell && colIndex) {
            this.selectedRow = rowIndex;
            this.selectedCol = colIndex;
        }
        if (ConfigService.config.clickEvent) {
            /** @type {?} */
            var value = {
                event: $event,
                row: row,
                key: key,
                rowId: rowIndex,
                colId: colIndex,
            };
            this.emitEvent(Event.onClick, value);
        }
    };
    /**
     * @param {?} $event
     * @param {?} row
     * @param {?} key
     * @param {?} colIndex
     * @param {?} rowIndex
     * @return {?}
     */
    BaseComponent.prototype.onDoubleClick = /**
     * @param {?} $event
     * @param {?} row
     * @param {?} key
     * @param {?} colIndex
     * @param {?} rowIndex
     * @return {?}
     */
    function ($event, row, key, colIndex, rowIndex) {
        /** @type {?} */
        var value = {
            event: $event,
            row: row,
            key: key,
            rowId: rowIndex,
            colId: colIndex,
        };
        this.emitEvent(Event.onDoubleClick, value);
    };
    /**
     * @param {?} $event
     * @param {?} row
     * @param {?} rowIndex
     * @return {?}
     */
    BaseComponent.prototype.onCheckboxSelect = /**
     * @param {?} $event
     * @param {?} row
     * @param {?} rowIndex
     * @return {?}
     */
    function ($event, row, rowIndex) {
        /** @type {?} */
        var value = {
            event: $event,
            row: row,
            rowId: rowIndex,
        };
        this.emitEvent(Event.onCheckboxSelect, value);
    };
    /**
     * @return {?}
     */
    BaseComponent.prototype.onSelectAll = /**
     * @return {?}
     */
    function () {
        this.isSelected = !this.isSelected;
        this.emitEvent(Event.onSelectAll, this.isSelected);
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    BaseComponent.prototype.onSearch = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (!ConfigService.config.serverPagination) {
            this.term = $event;
        }
        this.emitEvent(Event.onSearch, $event);
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    BaseComponent.prototype.onGlobalSearch = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (!ConfigService.config.serverPagination) {
            this.globalSearchTerm = $event;
        }
        this.emitEvent(Event.onGlobalSearch, $event);
    };
    /**
     * @param {?} pagination
     * @return {?}
     */
    BaseComponent.prototype.onPagination = /**
     * @param {?} pagination
     * @return {?}
     */
    function (pagination) {
        this.page = pagination.page;
        this.limit = pagination.limit;
        this.emitEvent(Event.onPagination, pagination);
    };
    /**
     * @private
     * @param {?} event
     * @param {?} value
     * @return {?}
     */
    BaseComponent.prototype.emitEvent = /**
     * @private
     * @param {?} event
     * @param {?} value
     * @return {?}
     */
    function (event, value) {
        this.event.emit({ event: event, value: value });
        if (this.config.persistState) {
            localStorage.setItem(event, JSON.stringify(value));
        }
        if (this.config.logger) {
            // tslint:disable-next-line:no-console
            console.log({ event: event, value: value });
        }
    };
    /**
     * @param {?} rowIndex
     * @return {?}
     */
    BaseComponent.prototype.collapseRow = /**
     * @param {?} rowIndex
     * @return {?}
     */
    function (rowIndex) {
        if (this.selectedDetailsTemplateRowId.has(rowIndex)) {
            this.selectedDetailsTemplateRowId.delete(rowIndex);
            this.emitEvent(Event.onRowCollapsedHide, rowIndex);
        }
        else {
            this.selectedDetailsTemplateRowId.add(rowIndex);
            this.emitEvent(Event.onRowCollapsedShow, rowIndex);
        }
    };
    /**
     * @private
     * @return {?}
     */
    BaseComponent.prototype.doDecodePersistedState = /**
     * @private
     * @return {?}
     */
    function () {
        if (!this.config.persistState) {
            return;
        }
        /** @type {?} */
        var pagination = localStorage.getItem(Event.onPagination);
        /** @type {?} */
        var sort = localStorage.getItem(Event.onOrder);
        /** @type {?} */
        var search = localStorage.getItem(Event.onSearch);
        if (pagination) {
            this.onPagination(JSON.parse(pagination));
        }
        if (sort) {
            var _a = JSON.parse(sort), key = _a.key, order = _a.order;
            this.sortBy.key = key;
            this.sortBy.order = order;
            this.data = tslib_1.__spread(this.data);
        }
        if (search) {
            this.term = JSON.parse(search);
        }
    };
    /**
     * @private
     * @return {?}
     */
    BaseComponent.prototype.doGroupRows = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.grouped = [];
        from(this.data).pipe(groupBy(function (row) { return row[_this.groupRowsBy]; }), flatMap(function (group) { return group.pipe(reduce(function (acc, curr) { return tslib_1.__spread(acc, [curr]); }, [])); })).subscribe(function (row) { return _this.grouped.push(row); });
    };
    /**
     * @param {?} rowIndex
     * @return {?}
     */
    BaseComponent.prototype.isRowCollapsed = /**
     * @param {?} rowIndex
     * @return {?}
     */
    function (rowIndex) {
        if (this.config.collapseAllRows) {
            return true;
        }
        return this.selectedDetailsTemplateRowId.has(rowIndex);
    };
    /**
     * @param {?} event
     * @param {?} th
     * @return {?}
     */
    BaseComponent.prototype.onMouseDown = /**
     * @param {?} event
     * @param {?} th
     * @return {?}
     */
    function (event, th) {
        if (!this.config.resizeColumn) {
            return;
        }
        this.th = th;
        this.startOffset = th.offsetWidth - event.pageX;
        this.emitEvent(Event.onColumnResizeMouseDown, event);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    BaseComponent.prototype.onMouseMove = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (!this.config.resizeColumn) {
            return;
        }
        if (this.th && this.th.style) {
            this.th.style.width = this.startOffset + event.pageX + 'px';
            this.th.style.cursor = 'col-resize';
            this.th.style['user-select'] = 'none';
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    BaseComponent.prototype.onMouseUp = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (!this.config.resizeColumn) {
            return;
        }
        this.emitEvent(Event.onColumnResizeMouseUp, event);
        this.th.style.cursor = 'default';
        this.th = undefined;
    };
    Object.defineProperty(BaseComponent.prototype, "isLoading", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var table = (/** @type {?} */ (document.getElementById('table')));
            if (table && table.rows && table.rows.length > 3) {
                this.getLoadingHeight(table.rows);
            }
            return this.config.isLoading;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} rows
     * @return {?}
     */
    BaseComponent.prototype.getLoadingHeight = /**
     * @param {?} rows
     * @return {?}
     */
    function (rows) {
        /** @type {?} */
        var searchEnabled = this.config.searchEnabled ? 1 : 0;
        /** @type {?} */
        var headerEnabled = this.config.headerEnabled ? 1 : 0;
        /** @type {?} */
        var borderTrHeight = 1;
        /** @type {?} */
        var borderDivHeight = 2;
        this.loadingHeight = (rows.length - searchEnabled - headerEnabled) * (rows[3].offsetHeight - borderTrHeight) - borderDivHeight + 'px';
    };
    /**
     * @param {?} column
     * @return {?}
     */
    BaseComponent.prototype.getColumnWidth = /**
     * @param {?} column
     * @return {?}
     */
    function (column) {
        if (column.width) {
            return column.width;
        }
        return this.config.fixedColumnWidth ? 100 / this.columns.length + '%' : null;
    };
    /**
     * @param {?} column
     * @return {?}
     */
    BaseComponent.prototype.getColumnDefinition = /**
     * @param {?} column
     * @return {?}
     */
    function (column) {
        return column.searchEnabled || typeof column.searchEnabled === 'undefined';
    };
    Object.defineProperty(BaseComponent.prototype, "arrowDefinition", {
        get: /**
         * @return {?}
         */
        function () {
            return this.config.showDetailsArrow || typeof this.config.showDetailsArrow === 'undefined';
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} $event
     * @param {?} row
     * @param {?} key
     * @param {?} colIndex
     * @param {?} rowIndex
     * @return {?}
     */
    BaseComponent.prototype.onRowContextMenu = /**
     * @param {?} $event
     * @param {?} row
     * @param {?} key
     * @param {?} colIndex
     * @param {?} rowIndex
     * @return {?}
     */
    function ($event, row, key, colIndex, rowIndex) {
        if (!this.config.showContextMenu) {
            return;
        }
        $event.preventDefault();
        /** @type {?} */
        var value = {
            event: $event,
            row: row,
            key: key,
            rowId: rowIndex,
            colId: colIndex,
        };
        this.rowContextMenuPosition = {
            top: $event.y - 10 + "px",
            left: $event.x - 10 + "px",
            value: value,
        };
        this.emitEvent(Event.onRowContextMenu, value);
    };
    /**
     * @private
     * @param {?} data
     * @return {?}
     */
    BaseComponent.prototype.doApplyData = /**
     * @private
     * @param {?} data
     * @return {?}
     */
    function (data) {
        /** @type {?} */
        var column = this.columns.find(function (c) { return !!c.orderBy; });
        if (column) {
            this.sortByIcon.order = (column.orderBy === 'asc') ? 'desc' : 'asc';
            this.orderBy(column);
        }
        else {
            this.data = tslib_1.__spread(data.currentValue);
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    BaseComponent.prototype.onDrop = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.emitEvent(Event.onRowDrop, event);
        moveItemInArray(this.data, event.previousIndex, event.currentIndex);
    };
    /**
     * @private
     * @return {?}
     */
    BaseComponent.prototype.bindApi = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.api.subscribe(function (event) {
            switch (event.type) {
                case API.rowContextMenuClicked:
                    _this.rowContextMenuPosition = {
                        top: null,
                        left: null,
                        value: null,
                    };
                    break;
                case API.toolPanelClicked:
                    // TODO
                    break;
                default:
                    console.warn('unrecognized API value');
            }
        });
    };
    BaseComponent.decorators = [
        { type: Component, args: [{
                    selector: 'ngx-table',
                    providers: [ConfigService, UtilsService],
                    template: "<div class=\"ngx-container\">\n  <div class=\"ngx-global-search\"\n       *ngIf=\"config.globalSearchEnabled\">\n    <global-search (globalUpdate)=\"onGlobalSearch($event)\"></global-search>\n  </div>\n  <table id=\"table\"\n         class=\"ngx-table\"\n         [class.ngx-table__table--tiny]=\"config.tableLayout.style === 'tiny'\"\n         [class.ngx-table__table--normal]=\"config.tableLayout.style === 'normal'\"\n         [class.ngx-table__table--big]=\"config.tableLayout.style === 'big'\"\n         [class.ngx-table__table--borderless]=\"config.tableLayout.borderless\"\n         [class.ngx-table__table--dark]=\"config.tableLayout.theme === 'dark'\"\n         [class.ngx-table__table--hoverable]=\"config.tableLayout.hover\"\n         [class.ngx-table__table--striped]=\"config.tableLayout.striped\"\n         [class.ngx-table__horizontal-scroll]=\"config.horizontalScroll && !isLoading\">\n    <thead>\n    <tr class=\"ngx-table__header\" *ngIf=\"config.headerEnabled\">\n      <th *ngIf=\"config.checkboxes\" width=\"3%\">\n        <ng-container\n          *ngIf=\"selectAllTemplate\"\n          [ngTemplateOutlet]=\"selectAllTemplate\"\n          [ngTemplateOutletContext]=\"{ $implicit: onSelectAllBinded }\">\n        </ng-container>\n        <label class=\"ngx-form-checkbox\" *ngIf=\"!selectAllTemplate\">\n          <input type=\"checkbox\" (change)=\"onSelectAll()\">\n          <i class=\"ngx-form-icon\" id=\"selectAllCheckbox\"></i>\n        </label>\n      </th>\n      <ng-container *ngFor=\"let column of columns; let colIndex = index\">\n        <th class=\"ngx-table__header-cell\"\n            #th\n            [attr.width]=\"getColumnWidth(column)\"\n            (mousedown)=\"onMouseDown($event, th)\"\n            (mouseup)=\"onMouseUp($event)\"\n            (mousemove)=\"onMouseMove($event)\">\n          <div (click)=\"orderBy(column)\" [class.pointer]=\"isOrderEnabled(column)\">\n            <div class=\"ngx-table__header-title\">{{ column.title }}<span>&nbsp;</span>\n              <i *ngIf=\"sortByIcon.key === column.key && sortByIcon.order==='asc'\"\n                 [style.display]=\"config.orderEnabled?'':'none' \"\n                 class=\"ngx-icon ngx-icon-arrow-up\">\n              </i>\n              <i *ngIf=\"sortByIcon.key === column.key && sortByIcon.order==='desc'\"\n                 [style.display]=\"config.orderEnabled?'':'none' \"\n                 class=\"ngx-icon ngx-icon-arrow-down\">\n              </i>\n            </div>\n          </div>\n          <div class=\"ngx-table__column-resizer\" *ngIf=\"config.resizeColumn\"></div>\n        </th>\n      </ng-container>\n      <th *ngIf=\"config.additionalActions || config.detailsTemplate || config.collapseAllRows || config.groupRows\"\n          class=\"ngx-table__header-cell-additional-actions\">\n        <div class=\"ngx-dropdown ngx-active\"\n             *ngIf=\"config.additionalActions\"\n             [class.ngx-active]=\"menuActive\">\n          <a class=\"ngx-btn ngx-btn-link\" (click)=\"menuActive = !menuActive\">\n            <span class=\"ngx-icon ngx-icon-menu\"></span>\n          </a>\n          <ul class=\"ngx-menu ngx-table__table-menu\">\n            <li class=\"ngx-menu-item\">\n              <app-csv-export [data]=\"data\"\n                              *ngIf=\"config.exportEnabled\">\n              </app-csv-export>\n            </li>\n          </ul>\n        </div>\n      </th>\n    </tr>\n    <tr *ngIf=\"config.searchEnabled && !filtersTemplate\"\n        class=\"ngx-table__sort-header\">\n      <th *ngIf=\"config.checkboxes\"></th>\n      <ng-container *ngFor=\"let column of columns\">\n        <th>\n          <table-header\n            *ngIf=\"getColumnDefinition(column)\"\n            (update)=\"onSearch($event)\"\n            [column]=\"column\">\n          </table-header>\n        </th>\n      </ng-container>\n      <th *ngIf=\"config.additionalActions || config.detailsTemplate\"></th>\n    </tr>\n    <ng-container *ngIf=\"filtersTemplate\">\n      <tr>\n        <ng-container [ngTemplateOutlet]=\"filtersTemplate\">\n        </ng-container>\n      </tr>\n    </ng-container>\n    </thead>\n    <tbody *ngIf=\"data && !isLoading  && !config.draggable\">\n    <ng-container *ngIf=\"rowTemplate\">\n      <ul class=\"ngx-table__table-row-context-menu\"\n          [ngStyle]=\"{'position': 'absolute', 'top': rowContextMenuPosition.top, 'left': rowContextMenuPosition.left }\"\n          *ngIf=\"rowContextMenuPosition.top\">\n        <ng-container\n          [ngTemplateOutlet]=\"rowContextMenu\"\n          [ngTemplateOutletContext]=\"{ $implicit: rowContextMenuPosition.value}\">\n        </ng-container>\n      </ul>\n      <ng-container *ngFor=\"let row of data | sort:sortBy | search:term | global:globalSearchTerm | paginate: { itemsPerPage: limit, currentPage: page, totalItems: count, id: id };\n              let rowIndex = index\">\n        <tr\n          (click)=\"onClick($event, row, '', null, rowIndex)\"\n          (contextmenu)=\"onRowContextMenu($event, row, '', null, rowIndex)\"\n          (dblclick)=\"onDoubleClick($event, row, '', null, rowIndex)\"\n          [class.ngx-table__table-row--selected]=\"rowIndex == selectedRow && !config.selectCell\">\n          <ng-container\n            [ngTemplateOutlet]=\"rowTemplate\"\n            [ngTemplateOutletContext]=\"{ $implicit: row, index: rowIndex }\">\n          </ng-container>\n          <td *ngIf=\"config.detailsTemplate\">\n            <span class=\"ngx-icon\"\n                  *ngIf=\"arrowDefinition\"\n                  [ngClass]=\"isRowCollapsed(rowIndex) ? 'ngx-icon-arrow-down' : 'ngx-icon-arrow-right'\"\n                  (click)=\"collapseRow(rowIndex)\">\n            </span>\n          </td>\n        </tr>\n        <tr\n          *ngIf=\"(config.detailsTemplate && selectedDetailsTemplateRowId.has(rowIndex)) || config.collapseAllRows\">\n          <td [attr.colspan]=\"columns.length + 1\">\n            <ng-container\n              [ngTemplateOutlet]=\"detailsTemplate\"\n              [ngTemplateOutletContext]=\"{ $implicit: row, index: rowIndex  }\">\n            </ng-container>\n          </td>\n        </tr>\n      </ng-container>\n    </ng-container>\n    <ng-container *ngIf=\"!rowTemplate && !config.groupRows\">\n      <ul class=\"ngx-table__table-row-context-menu\"\n          [ngStyle]=\"{'position': 'absolute', 'top': rowContextMenuPosition.top, 'left': rowContextMenuPosition.left }\"\n          *ngIf=\"rowContextMenuPosition.top\">\n        <ng-container\n          [ngTemplateOutlet]=\"rowContextMenu\"\n          [ngTemplateOutletContext]=\"{ $implicit: rowContextMenuPosition.value}\">\n        </ng-container>\n      </ul>\n      <ng-container\n        *ngFor=\"let row of data | sort:sortBy | search:term | global:globalSearchTerm | paginate: { itemsPerPage: limit, currentPage: page, totalItems: count, id: id };\n                  let rowIndex = index\">\n        <tr [class.ngx-table__table-row--selected]=\"rowIndex == selectedRow && !config.selectCell\">\n          <td *ngIf=\"config.checkboxes\">\n            <label class=\"ngx-form-checkbox\">\n              <input type=\"checkbox\"\n                     id=\"checkbox-{{rowIndex}}\"\n                     [checked]=\"isSelected\"\n                     (change)=\"onCheckboxSelect($event, row, rowIndex)\">\n              <i class=\"ngx-form-icon\"></i>\n            </label>\n          </td>\n          <ng-container *ngFor=\"let column of columns; let colIndex = index\">\n            <td (click)=\"onClick($event, row, column.key, colIndex, rowIndex)\"\n                (contextmenu)=\"onRowContextMenu($event, row, column.key, colIndex, rowIndex)\"\n                (dblclick)=\"onDoubleClick($event, row, column.key, colIndex, rowIndex)\"\n                [class.ngx-table__table-col--selected]=\"colIndex == selectedCol && !config.selectCell\"\n                [class.ngx-table__table-cell--selected]=\"colIndex == selectedCol && rowIndex == selectedRow && !config.selectCol && !config.selectRow\"\n            >\n              <div *ngIf=\"!column.cellTemplate\">{{ row | render:column.key }}</div>\n              <ng-container\n                *ngIf=\"column.cellTemplate\"\n                [ngTemplateOutlet]=\"column.cellTemplate\"\n                [ngTemplateOutletContext]=\"{ $implicit: row, rowIndex: rowIndex }\">\n              </ng-container>\n            </td>\n          </ng-container>\n          <td *ngIf=\"config.additionalActions || config.detailsTemplate\">\n            <span class=\"ngx-icon\"\n                  *ngIf=\"arrowDefinition\"\n                  [ngClass]=\"isRowCollapsed(rowIndex) ? 'ngx-icon-arrow-down' : 'ngx-icon-arrow-right'\"\n                  (click)=\"collapseRow(rowIndex)\">\n            </span>\n          </td>\n        </tr>\n        <tr\n          *ngIf=\"(config.detailsTemplate && selectedDetailsTemplateRowId.has(rowIndex)) || config.collapseAllRows\">\n          <td *ngIf=\"config.checkboxes\"></td>\n          <td [attr.colspan]=\"columns.length + 1\">\n            <ng-container\n              [ngTemplateOutlet]=\"detailsTemplate\"\n              [ngTemplateOutletContext]=\"{ $implicit: row, index: rowIndex }\">\n            </ng-container>\n          </td>\n        </tr>\n      </ng-container>\n    </ng-container>\n    <ng-container *ngIf=\"!rowTemplate && config.groupRows\">\n      <ng-container\n        *ngFor=\"let group of grouped | sort:sortBy | search:term | global:globalSearchTerm | paginate: { itemsPerPage: limit, currentPage: page, totalItems: count, id: id }; let rowIndex = index\">\n        <tr>\n          <ng-container *ngIf=\"!groupRowsHeaderTemplate\">\n            <td [attr.colspan]=\"columns.length\">\n              <div>{{group[0][groupRowsBy]}} ({{group.length}})</div>\n            </td>\n          </ng-container>\n          <ng-container\n            *ngIf=\"groupRowsHeaderTemplate\"\n            [ngTemplateOutlet]=\"groupRowsHeaderTemplate\"\n            [ngTemplateOutletContext]=\"{\n              total: group.length,\n              key: groupRowsBy,\n              value: group[0][groupRowsBy],\n              group: group,\n              index: rowIndex\n            }\">\n          </ng-container>\n          <td>\n            <span class=\"ngx-icon\"\n                  *ngIf=\"arrowDefinition\"\n                  [ngClass]=\"isRowCollapsed(rowIndex) ? 'ngx-icon-arrow-down' : 'ngx-icon-arrow-right'\"\n                  (click)=\"collapseRow(rowIndex)\">\n            </span>\n          </td>\n        </tr>\n        <ng-container *ngIf=\"selectedDetailsTemplateRowId.has(rowIndex)\">\n          <tr *ngFor=\"let row of group\">\n            <td *ngFor=\"let column of columns\">\n              {{ row | render:column.key }}\n              <!-- TODO allow users to add groupRowsTemplateRef -->\n            </td>\n            <td></td>\n          </tr>\n        </ng-container>\n      </ng-container>\n    </ng-container>\n    </tbody>\n    <tbody *ngIf=\"data && !config.isLoading && config.draggable\" cdkDropList (cdkDropListDropped)=\"onDrop($event)\">\n    <ng-container *ngIf=\"!rowTemplate && !config.groupRows\">\n      <ng-container\n        *ngFor=\"let row of data | sort:sortBy | search:term | global:globalSearchTerm | paginate: { itemsPerPage: limit, currentPage: page, totalItems: count, id: id };\n                  let rowIndex = index\">\n        <tr class=\"ngx-draggable-row\" cdkDrag>\n          <td *ngIf=\"config.checkboxes\">\n            <label class=\"ngx-form-checkbox\">\n              <input type=\"checkbox\"\n                     id=\"checkbox-draggable-{{rowIndex}}\"\n                     [checked]=\"isSelected\"\n                     (change)=\"onCheckboxSelect($event, row, rowIndex)\">\n              <i class=\"ngx-form-icon\"></i>\n            </label>\n          </td>\n          <ng-container *ngFor=\"let column of columns; let colIndex = index\">\n            <td (click)=\"onClick($event, row, column.key, colIndex, rowIndex)\"\n                (dblclick)=\"onDoubleClick($event, row, column.key, colIndex, rowIndex)\"\n                [class.ngx-table__table-col--selected]=\"colIndex == selectedCol && !config.selectCell\"\n                [class.ngx-table__table-cell--selected]=\"colIndex == selectedCol && rowIndex == selectedRow && !config.selectCol && !config.selectRow\"\n            >\n              <div>{{ row | render:column.key }}</div>\n            </td>\n          </ng-container>\n        </tr>\n      </ng-container>\n    </ng-container>\n    </tbody>\n    <tbody *ngIf=\"!isLoading && (!data || (data && data.length < 1))\">\n    <tr class=\"ngx-table__body-empty\">\n      <ng-container\n        *ngIf=\"noResultsTemplate\"\n        [ngTemplateOutlet]=\"noResultsTemplate\">\n      </ng-container>\n      <td [attr.colspan]=\"columns && columns.length + 1\" *ngIf=\"!noResultsTemplate\">\n        <div class=\"ngx-table__table-no-results\">\n          No results\n        </div>\n      </td>\n    </tr>\n    </tbody>\n    <tbody *ngIf=\"isLoading\">\n    <tr class=\"ngx-table__body-loading\">\n      <td [attr.colspan]=\"columns && columns.length + 1\">\n        <div [style.height]=\"loadingHeight\"\n             class=\"ngx-table__table-loader-wrapper\">\n          <div class=\"ngx-table__table-loader\"></div>\n        </div>\n      </td>\n    </tr>\n    </tbody>\n    <tfoot *ngIf=\"summaryTemplate\">\n    <tr>\n      <ng-container\n        [ngTemplateOutlet]=\"summaryTemplate\"\n        [ngTemplateOutletContext]=\"{ total: data.length, limit: limit, page: page  }\">\n      </ng-container>\n    </tr>\n    </tfoot>\n  </table>\n  <pagination\n    id=\"pagination\"\n    *ngIf=\"config.paginationEnabled\"\n    [id]=\"id\"\n    [config]=\"config\"\n    [pagination]=\"pagination\"\n    (updateRange)=\"onPagination($event)\">\n  </pagination>\n</div>\n",
                    changeDetection: ChangeDetectionStrategy.OnPush
                }] }
    ];
    /** @nocollapse */
    BaseComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    BaseComponent.propDecorators = {
        configuration: [{ type: Input, args: ['configuration',] }],
        api: [{ type: Input }],
        data: [{ type: Input }],
        pagination: [{ type: Input }],
        groupRowsBy: [{ type: Input }],
        toggleRowIndex: [{ type: Input }],
        detailsTemplate: [{ type: Input }],
        summaryTemplate: [{ type: Input }],
        groupRowsHeaderTemplate: [{ type: Input }],
        filtersTemplate: [{ type: Input }],
        selectAllTemplate: [{ type: Input }],
        noResultsTemplate: [{ type: Input }],
        rowContextMenu: [{ type: Input }],
        columns: [{ type: Input }],
        event: [{ type: Output }],
        rowTemplate: [{ type: ContentChild, args: [TemplateRef,] }]
    };
    return BaseComponent;
}());
export { BaseComponent };
if (false) {
    /** @type {?} */
    BaseComponent.prototype.selectedRow;
    /** @type {?} */
    BaseComponent.prototype.selectedCol;
    /** @type {?} */
    BaseComponent.prototype.term;
    /** @type {?} */
    BaseComponent.prototype.globalSearchTerm;
    /** @type {?} */
    BaseComponent.prototype.grouped;
    /** @type {?} */
    BaseComponent.prototype.menuActive;
    /** @type {?} */
    BaseComponent.prototype.isSelected;
    /** @type {?} */
    BaseComponent.prototype.page;
    /** @type {?} */
    BaseComponent.prototype.count;
    /** @type {?} */
    BaseComponent.prototype.rowContextMenuPosition;
    /** @type {?} */
    BaseComponent.prototype.limit;
    /** @type {?} */
    BaseComponent.prototype.sortBy;
    /** @type {?} */
    BaseComponent.prototype.sortByIcon;
    /** @type {?} */
    BaseComponent.prototype.selectedDetailsTemplateRowId;
    /** @type {?} */
    BaseComponent.prototype.id;
    /** @type {?} */
    BaseComponent.prototype.th;
    /** @type {?} */
    BaseComponent.prototype.startOffset;
    /** @type {?} */
    BaseComponent.prototype.loadingHeight;
    /** @type {?} */
    BaseComponent.prototype.config;
    /** @type {?} */
    BaseComponent.prototype.onSelectAllBinded;
    /** @type {?} */
    BaseComponent.prototype.api;
    /** @type {?} */
    BaseComponent.prototype.data;
    /** @type {?} */
    BaseComponent.prototype.pagination;
    /** @type {?} */
    BaseComponent.prototype.groupRowsBy;
    /** @type {?} */
    BaseComponent.prototype.toggleRowIndex;
    /** @type {?} */
    BaseComponent.prototype.detailsTemplate;
    /** @type {?} */
    BaseComponent.prototype.summaryTemplate;
    /** @type {?} */
    BaseComponent.prototype.groupRowsHeaderTemplate;
    /** @type {?} */
    BaseComponent.prototype.filtersTemplate;
    /** @type {?} */
    BaseComponent.prototype.selectAllTemplate;
    /** @type {?} */
    BaseComponent.prototype.noResultsTemplate;
    /** @type {?} */
    BaseComponent.prototype.rowContextMenu;
    /** @type {?} */
    BaseComponent.prototype.columns;
    /** @type {?} */
    BaseComponent.prototype.event;
    /** @type {?} */
    BaseComponent.prototype.rowTemplate;
    /**
     * @type {?}
     * @private
     */
    BaseComponent.prototype.cdr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtZWFzeS10YWJsZS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL2Jhc2UvYmFzZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQWUsZUFBZSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDdEUsT0FBTyxFQUVMLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUNULFlBQVksRUFDWixZQUFZLEVBQ1osS0FBSyxFQUdMLE1BQU0sRUFHTixXQUFXLEdBQ1osTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDckMsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDMUQsT0FBTyxFQUFtQixLQUFLLEVBQUUsTUFBTSxPQUFPLENBQUM7QUFDL0MsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQzlELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUc1RCxPQUFPLEVBQUUsR0FBRyxFQUFXLE1BQU0saUJBQWlCLENBQUM7Ozs7QUFJL0MscUNBSUM7OztJQUhDLHFDQUFtQjs7SUFDbkIsc0NBQW9COztJQUNwQix1Q0FBa0I7O0FBR3BCO0lBK0RFLHVCQUE2QixHQUFzQjtRQUF0QixRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQXBENUMsWUFBTyxHQUFRLEVBQUUsQ0FBQztRQUNsQixlQUFVLEdBQUcsS0FBSyxDQUFDO1FBQ25CLGVBQVUsR0FBRyxLQUFLLENBQUM7UUFDbkIsU0FBSSxHQUFHLENBQUMsQ0FBQztRQUNULFVBQUssR0FBRyxJQUFJLENBQUM7UUFDYiwyQkFBc0IsR0FBMkI7WUFDdEQsR0FBRyxFQUFFLElBQUk7WUFDVCxJQUFJLEVBQUUsSUFBSTtZ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OztJQUN4QixnQ0FBeUI7O0lBQ3pCLG1DQUEwQjs7SUFDMUIsbUNBQTBCOztJQUMxQiw2QkFBZ0I7O0lBQ2hCLDhCQUFvQjs7SUFDcEIsK0NBSUU7O0lBQ0YsOEJBQWE7O0lBQ2IsK0JBR0U7O0lBQ0YsbUNBR0U7O0lBQ0YscURBQWdEOztJQUNoRCwyQkFBVTs7SUFDViwyQkFBVTs7SUFDVixvQ0FBbUI7O0lBQ25CLHNDQUE4Qjs7SUFDOUIsK0JBQXNCOztJQUN0QiwwQ0FBZ0Q7O0lBV2hELDRCQUErQjs7SUFDL0IsNkJBQXFCOztJQUNyQixtQ0FBZ0M7O0lBQ2hDLG9DQUE2Qjs7SUFDN0IsdUNBQXdCOztJQUN4Qix3Q0FBMkM7O0lBQzNDLHdDQUEyQzs7SUFDM0MsZ0RBQW1EOztJQUNuRCx3Q0FBMkM7O0lBQzNDLDBDQUE2Qzs7SUFDN0MsMENBQTZDOztJQUM3Qyx1Q0FBMEM7O0lBQzFDLGdDQUE0Qjs7SUFDNUIsOEJBQTZFOztJQUM3RSxvQ0FBZ0U7Ozs7O0lBRXBELDRCQUF1QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENka0RyYWdEcm9wLCBtb3ZlSXRlbUluQXJyYXkgfSBmcm9tICdAYW5ndWxhci9jZGsvZHJhZy1kcm9wJztcbmltcG9ydCB7XG4gIEFmdGVyVmlld0luaXQsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBDb250ZW50Q2hpbGQsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFNpbXBsZUNoYW5nZSxcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgVGVtcGxhdGVSZWYsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBmcm9tLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmbGF0TWFwLCBncm91cEJ5LCByZWR1Y2UgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBDb2x1bW5zLCBDb25maWcsIEV2ZW50IH0gZnJvbSAnLi4vLi4nO1xuaW1wb3J0IHsgQ29uZmlnU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2NvbmZpZy1zZXJ2aWNlJztcbmltcG9ydCB7IFV0aWxzU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3V0aWxzLXNlcnZpY2UnO1xuaW1wb3J0IHsgUGFnaW5hdGlvbk9iamVjdCB9IGZyb20gJy4uL3BhZ2luYXRpb24vcGFnaW5hdGlvbi5jb21wb25lbnQnO1xuaW1wb3J0IHsgUGFnaW5hdGlvbiB9IGZyb20gJy4uLy4uL21vZGVsL3BhZ2luYXRpb24nO1xuaW1wb3J0IHsgQVBJLCBBcGlUeXBlIH0gZnJvbSAnLi4vLi4vbW9kZWwvYXBpJztcblxudHlwZSBLZXlUeXBlID0gc3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbjtcblxuaW50ZXJmYWNlIFJvd0NvbnRleHRNZW51UG9zaXRpb24ge1xuICB0b3A6IHN0cmluZyB8IG51bGw7XG4gIGxlZnQ6IHN0cmluZyB8IG51bGw7XG4gIHZhbHVlOiBhbnkgfCBudWxsO1xufVxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICduZ3gtdGFibGUnLFxuICBwcm92aWRlcnM6IFtDb25maWdTZXJ2aWNlLCBVdGlsc1NlcnZpY2VdLFxuICB0ZW1wbGF0ZVVybDogJy4vYmFzZS5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIEFmdGVyVmlld0luaXQge1xuICBwdWJsaWMgc2VsZWN0ZWRSb3c6IG51bWJlcjtcbiAgcHVibGljIHNlbGVjdGVkQ29sOiBudW1iZXI7XG4gIHB1YmxpYyB0ZXJtO1xuICBwdWJsaWMgZ2xvYmFsU2VhcmNoVGVybTtcbiAgcHVibGljIGdyb3VwZWQ6IGFueSA9IFtdO1xuICBwdWJsaWMgbWVudUFjdGl2ZSA9IGZhbHNlO1xuICBwdWJsaWMgaXNTZWxlY3RlZCA9IGZhbHNlO1xuICBwdWJsaWMgcGFnZSA9IDE7XG4gIHB1YmxpYyBjb3VudCA9IG51bGw7XG4gIHB1YmxpYyByb3dDb250ZXh0TWVudVBvc2l0aW9uOiBSb3dDb250ZXh0TWVudVBvc2l0aW9uID0ge1xuICAgIHRvcDogbnVsbCxcbiAgICBsZWZ0OiBudWxsLFxuICAgIHZhbHVlOiBudWxsLFxuICB9O1xuICBwdWJsaWMgbGltaXQ7XG4gIHB1YmxpYyBzb3J0Qnk6IHsga2V5OiBzdHJpbmcgfSAmIHsgb3JkZXI6IHN0cmluZyB9ID0ge1xuICAgIGtleTogJycsXG4gICAgb3JkZXI6ICdhc2MnLFxuICB9O1xuICBwdWJsaWMgc29ydEJ5SWNvbjogeyBrZXk6IHN0cmluZyB9ICYgeyBvcmRlcjogc3RyaW5nIH0gPSB7XG4gICAga2V5OiAnJyxcbiAgICBvcmRlcjogJ2FzYycsXG4gIH07XG4gIHB1YmxpYyBzZWxlY3RlZERldGFpbHNUZW1wbGF0ZVJvd0lkID0gbmV3IFNldCgpO1xuICBwdWJsaWMgaWQ7XG4gIHB1YmxpYyB0aDtcbiAgcHVibGljIHN0YXJ0T2Zmc2V0O1xuICBwdWJsaWMgbG9hZGluZ0hlaWdodCA9ICczMHB4JztcbiAgcHVibGljIGNvbmZpZzogQ29uZmlnO1xuICBvblNlbGVjdEFsbEJpbmRlZCA9IHRoaXMub25TZWxlY3RBbGwuYmluZCh0aGlzKTtcblxuICBASW5wdXQoJ2NvbmZpZ3VyYXRpb24nKVxuICBzZXQgY29uZmlndXJhdGlvbih2YWx1ZTogQ29uZmlnKSB7XG4gICAgdGhpcy5jb25maWcgPSB2YWx1ZTtcbiAgfVxuXG4gIGdldCBjb25maWd1cmF0aW9uKCk6IENvbmZpZyB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnO1xuICB9XG5cbiAgQElucHV0KCkgYXBpOiBTdWJqZWN0PEFwaVR5cGU+O1xuICBASW5wdXQoKSBkYXRhOiBhbnlbXTtcbiAgQElucHV0KCkgcGFnaW5hdGlvbjogUGFnaW5hdGlvbjtcbiAgQElucHV0KCkgZ3JvdXBSb3dzQnk6IHN0cmluZztcbiAgQElucHV0KCkgdG9nZ2xlUm93SW5kZXg7XG4gIEBJbnB1dCgpIGRldGFpbHNUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcbiAgQElucHV0KCkgc3VtbWFyeVRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xuICBASW5wdXQoKSBncm91cFJvd3NIZWFkZXJUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcbiAgQElucHV0KCkgZmlsdGVyc1RlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xuICBASW5wdXQoKSBzZWxlY3RBbGxUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcbiAgQElucHV0KCkgbm9SZXN1bHRzVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG4gIEBJbnB1dCgpIHJvd0NvbnRleHRNZW51OiBUZW1wbGF0ZVJlZjxhbnk+O1xuICBASW5wdXQoKSBjb2x1bW5zOiBDb2x1bW5zW107XG4gIEBPdXRwdXQoKSByZWFkb25seSBldmVudCA9IG5ldyBFdmVudEVtaXR0ZXI8eyBldmVudDogc3RyaW5nLCB2YWx1ZTogYW55IH0+KCk7XG4gIEBDb250ZW50Q2hpbGQoVGVtcGxhdGVSZWYpIHB1YmxpYyByb3dUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICB0aGlzLmlkID0gVXRpbHNTZXJ2aWNlLnJhbmRvbUlkKCk7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBpZiAoIXRoaXMuY29sdW1ucykge1xuICAgICAgY29uc29sZS5lcnJvcignW2NvbHVtbnNdIHByb3BlcnR5IHJlcXVpcmVkIScpO1xuICAgIH1cbiAgICBpZiAodGhpcy5jb25maWd1cmF0aW9uKSB7XG4gICAgICBDb25maWdTZXJ2aWNlLmNvbmZpZyA9IHRoaXMuY29uZmlndXJhdGlvbjtcbiAgICB9XG4gICAgdGhpcy5jb25maWcgPSBDb25maWdTZXJ2aWNlLmNvbmZpZztcbiAgICBpZiAodGhpcy5hcGkpIHtcbiAgICAgIHRoaXMuYmluZEFwaSgpO1xuICAgIH1cbiAgICB0aGlzLmxpbWl0ID0gdGhpcy5jb25maWcucm93cztcbiAgICBpZiAodGhpcy5ncm91cFJvd3NCeSkge1xuICAgICAgdGhpcy5kb0dyb3VwUm93cygpO1xuICAgIH1cbiAgICB0aGlzLmRvRGVjb2RlUGVyc2lzdGVkU3RhdGUoKTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgY29uc3QgZGF0YTogU2ltcGxlQ2hhbmdlID0gY2hhbmdlcy5kYXRhO1xuICAgIGNvbnN0IHBhZ2luYXRpb246IFNpbXBsZUNoYW5nZSA9IGNoYW5nZXMucGFnaW5hdGlvbjtcbiAgICBjb25zdCBncm91cFJvd3NCeTogU2ltcGxlQ2hhbmdlID0gY2hhbmdlcy5ncm91cFJvd3NCeTtcbiAgICB0aGlzLnRvZ2dsZVJvd0luZGV4ID0gY2hhbmdlcy50b2dnbGVSb3dJbmRleDtcbiAgICBpZiAoZGF0YSAmJiBkYXRhLmN1cnJlbnRWYWx1ZSkge1xuICAgICAgdGhpcy5kb0FwcGx5RGF0YShkYXRhKTtcbiAgICB9XG4gICAgaWYgKHBhZ2luYXRpb24gJiYgcGFnaW5hdGlvbi5jdXJyZW50VmFsdWUpIHtcbiAgICAgIHRoaXMuY291bnQgPSBwYWdpbmF0aW9uLmN1cnJlbnRWYWx1ZS5jb3VudDtcbiAgICB9XG4gICAgaWYgKGdyb3VwUm93c0J5ICYmIGdyb3VwUm93c0J5LmN1cnJlbnRWYWx1ZSkge1xuICAgICAgdGhpcy5kb0dyb3VwUm93cygpO1xuICAgIH1cbiAgICBpZiAodGhpcy50b2dnbGVSb3dJbmRleCAmJiB0aGlzLnRvZ2dsZVJvd0luZGV4LmN1cnJlbnRWYWx1ZSkge1xuICAgICAgY29uc3Qgcm93ID0gdGhpcy50b2dnbGVSb3dJbmRleC5jdXJyZW50VmFsdWU7XG4gICAgICB0aGlzLmNvbGxhcHNlUm93KHJvdy5pbmRleCk7XG4gICAgfVxuICB9XG5cbiAgaXNPcmRlckVuYWJsZWQoY29sdW1uOiBDb2x1bW5zKSB7XG4gICAgY29uc3QgY29sdW1uT3JkZXJFbmFibGVkID0gY29sdW1uLm9yZGVyRW5hYmxlZCA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6ICEhY29sdW1uLm9yZGVyRW5hYmxlZDtcbiAgICByZXR1cm4gQ29uZmlnU2VydmljZS5jb25maWcub3JkZXJFbmFibGVkICYmIGNvbHVtbk9yZGVyRW5hYmxlZDtcbiAgfVxuXG4gIG9yZGVyQnkoY29sdW1uOiBDb2x1bW5zKTogdm9pZCB7XG4gICAgaWYgKHR5cGVvZiBjb2x1bW4ub3JkZXJFbmFibGVkICE9PSAndW5kZWZpbmVkJyAmJiAhY29sdW1uLm9yZGVyRW5hYmxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBrZXkgPSBjb2x1bW4ua2V5O1xuICAgIGlmICghQ29uZmlnU2VydmljZS5jb25maWcub3JkZXJFbmFibGVkIHx8IGtleSA9PT0gJycpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnNvcnRCeUljb24ua2V5ID0ga2V5O1xuICAgIGlmICh0aGlzLnNvcnRCeUljb24ub3JkZXIgPT09ICdhc2MnKSB7XG4gICAgICB0aGlzLnNvcnRCeUljb24ub3JkZXIgPSAnZGVzYyc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc29ydEJ5SWNvbi5vcmRlciA9ICdhc2MnO1xuICAgIH1cblxuICAgIGlmICghQ29uZmlnU2VydmljZS5jb25maWcub3JkZXJFdmVudE9ubHkgJiYgIWNvbHVtbi5vcmRlckV2ZW50T25seSkge1xuICAgICAgdGhpcy5zb3J0Qnkua2V5ID0gdGhpcy5zb3J0QnlJY29uLmtleTtcbiAgICAgIHRoaXMuc29ydEJ5Lm9yZGVyID0gdGhpcy5zb3J0QnlJY29uLm9yZGVyO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNvcnRCeS5rZXkgPSAnJztcbiAgICAgIHRoaXMuc29ydEJ5Lm9yZGVyID0gJyc7XG4gICAgfVxuICAgIGlmICghQ29uZmlnU2VydmljZS5jb25maWcuc2VydmVyUGFnaW5hdGlvbikge1xuICAgICAgdGhpcy5kYXRhID0gWy4uLnRoaXMuZGF0YV07XG4gICAgfVxuICAgIGNvbnN0IHZhbHVlID0ge1xuICAgICAga2V5LFxuICAgICAgb3JkZXI6IHRoaXMuc29ydEJ5SWNvbi5vcmRlcixcbiAgICB9O1xuICAgIHRoaXMuZW1pdEV2ZW50KEV2ZW50Lm9uT3JkZXIsIHZhbHVlKTtcbiAgfVxuXG4gIG9uQ2xpY2soJGV2ZW50OiBNb3VzZUV2ZW50LCByb3c6IG9iamVjdCwga2V5OiBLZXlUeXBlLCBjb2xJbmRleDogbnVtYmVyIHwgbnVsbCwgcm93SW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgIGlmIChDb25maWdTZXJ2aWNlLmNvbmZpZy5zZWxlY3RSb3cpIHtcbiAgICAgIHRoaXMuc2VsZWN0ZWRSb3cgPSByb3dJbmRleDtcbiAgICB9XG4gICAgaWYgKENvbmZpZ1NlcnZpY2UuY29uZmlnLnNlbGVjdENvbCAmJiBjb2xJbmRleCkge1xuICAgICAgdGhpcy5zZWxlY3RlZENvbCA9IGNvbEluZGV4O1xuICAgIH1cbiAgICBpZiAoQ29uZmlnU2VydmljZS5jb25maWcuc2VsZWN0Q2VsbCAmJiBjb2xJbmRleCkge1xuICAgICAgdGhpcy5zZWxlY3RlZFJvdyA9IHJvd0luZGV4O1xuICAgICAgdGhpcy5zZWxlY3RlZENvbCA9IGNvbEluZGV4O1xuICAgIH1cbiAgICBpZiAoQ29uZmlnU2VydmljZS5jb25maWcuY2xpY2tFdmVudCkge1xuICAgICAgY29uc3QgdmFsdWUgPSB7XG4gICAgICAgIGV2ZW50OiAkZXZlbnQsXG4gICAgICAgIHJvdyxcbiAgICAgICAga2V5LFxuICAgICAgICByb3dJZDogcm93SW5kZXgsXG4gICAgICAgIGNvbElkOiBjb2xJbmRleCxcbiAgICAgIH07XG4gICAgICB0aGlzLmVtaXRFdmVudChFdmVudC5vbkNsaWNrLCB2YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgb25Eb3VibGVDbGljaygkZXZlbnQ6IE1vdXNlRXZlbnQsIHJvdzogb2JqZWN0LCBrZXk6IEtleVR5cGUsIGNvbEluZGV4OiBudW1iZXIgfCBudWxsLCByb3dJbmRleDogbnVtYmVyKTogdm9pZCB7XG4gICAgY29uc3QgdmFsdWUgPSB7XG4gICAgICBldmVudDogJGV2ZW50LFxuICAgICAgcm93LFxuICAgICAga2V5LFxuICAgICAgcm93SWQ6IHJvd0luZGV4LFxuICAgICAgY29sSWQ6IGNvbEluZGV4LFxuICAgIH07XG4gICAgdGhpcy5lbWl0RXZlbnQoRXZlbnQub25Eb3VibGVDbGljaywgdmFsdWUpO1xuICB9XG5cbiAgb25DaGVja2JveFNlbGVjdCgkZXZlbnQ6IG9iamVjdCwgcm93OiBvYmplY3QsIHJvd0luZGV4OiBudW1iZXIpOiB2b2lkIHtcbiAgICBjb25zdCB2YWx1ZSA9IHtcbiAgICAgIGV2ZW50OiAkZXZlbnQsXG4gICAgICByb3csXG4gICAgICByb3dJZDogcm93SW5kZXgsXG4gICAgfTtcbiAgICB0aGlzLmVtaXRFdmVudChFdmVudC5vbkNoZWNrYm94U2VsZWN0LCB2YWx1ZSk7XG4gIH1cblxuICBvblNlbGVjdEFsbCgpIHtcbiAgICB0aGlzLmlzU2VsZWN0ZWQgPSAhdGhpcy5pc1NlbGVjdGVkO1xuICAgIHRoaXMuZW1pdEV2ZW50KEV2ZW50Lm9uU2VsZWN0QWxsLCB0aGlzLmlzU2VsZWN0ZWQpO1xuICB9XG5cbiAgb25TZWFyY2goJGV2ZW50OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAoIUNvbmZpZ1NlcnZpY2UuY29uZmlnLnNlcnZlclBhZ2luYXRpb24pIHtcbiAgICAgIHRoaXMudGVybSA9ICRldmVudDtcbiAgICB9XG4gICAgdGhpcy5lbWl0RXZlbnQoRXZlbnQub25TZWFyY2gsICRldmVudCk7XG4gIH1cblxuICBvbkdsb2JhbFNlYXJjaCgkZXZlbnQ6IHN0cmluZyk6IHZvaWQge1xuICAgIGlmICghQ29uZmlnU2VydmljZS5jb25maWcuc2VydmVyUGFnaW5hdGlvbikge1xuICAgICAgdGhpcy5nbG9iYWxTZWFyY2hUZXJtID0gJGV2ZW50O1xuICAgIH1cbiAgICB0aGlzLmVtaXRFdmVudChFdmVudC5vbkdsb2JhbFNlYXJjaCwgJGV2ZW50KTtcbiAgfVxuXG4gIG9uUGFnaW5hdGlvbihwYWdpbmF0aW9uOiBQYWdpbmF0aW9uT2JqZWN0KTogdm9pZCB7XG4gICAgdGhpcy5wYWdlID0gcGFnaW5hdGlvbi5wYWdlO1xuICAgIHRoaXMubGltaXQgPSBwYWdpbmF0aW9uLmxpbWl0O1xuICAgIHRoaXMuZW1pdEV2ZW50KEV2ZW50Lm9uUGFnaW5hdGlvbiwgcGFnaW5hdGlvbik7XG4gIH1cblxuICBwcml2YXRlIGVtaXRFdmVudChldmVudDogc3RyaW5nLCB2YWx1ZTogYW55KTogdm9pZCB7XG4gICAgdGhpcy5ldmVudC5lbWl0KHsgZXZlbnQsIHZhbHVlIH0pO1xuICAgIGlmICh0aGlzLmNvbmZpZy5wZXJzaXN0U3RhdGUpIHtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGV2ZW50LCBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpO1xuICAgIH1cbiAgICBpZiAodGhpcy5jb25maWcubG9nZ2VyKSB7XG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tY29uc29sZVxuICAgICAgY29uc29sZS5sb2coeyBldmVudCwgdmFsdWUgfSk7XG4gICAgfVxuICB9XG5cbiAgY29sbGFwc2VSb3cocm93SW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgIGlmICh0aGlzLnNlbGVjdGVkRGV0YWlsc1RlbXBsYXRlUm93SWQuaGFzKHJvd0luZGV4KSkge1xuICAgICAgdGhpcy5zZWxlY3RlZERldGFpbHNUZW1wbGF0ZVJvd0lkLmRlbGV0ZShyb3dJbmRleCk7XG4gICAgICB0aGlzLmVtaXRFdmVudChFdmVudC5vblJvd0NvbGxhcHNlZEhpZGUsIHJvd0luZGV4KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZWxlY3RlZERldGFpbHNUZW1wbGF0ZVJvd0lkLmFkZChyb3dJbmRleCk7XG4gICAgICB0aGlzLmVtaXRFdmVudChFdmVudC5vblJvd0NvbGxhcHNlZFNob3csIHJvd0luZGV4KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGRvRGVjb2RlUGVyc2lzdGVkU3RhdGUoKSB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5wZXJzaXN0U3RhdGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgcGFnaW5hdGlvbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKEV2ZW50Lm9uUGFnaW5hdGlvbik7XG4gICAgY29uc3Qgc29ydCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKEV2ZW50Lm9uT3JkZXIpO1xuICAgIGNvbnN0IHNlYXJjaCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKEV2ZW50Lm9uU2VhcmNoKTtcbiAgICBpZiAocGFnaW5hdGlvbikge1xuICAgICAgdGhpcy5vblBhZ2luYXRpb24oSlNPTi5wYXJzZShwYWdpbmF0aW9uKSk7XG4gICAgfVxuICAgIGlmIChzb3J0KSB7XG4gICAgICBjb25zdCB7IGtleSwgb3JkZXIgfSA9IEpTT04ucGFyc2Uoc29ydCk7XG4gICAgICB0aGlzLnNvcnRCeS5rZXkgPSBrZXk7XG4gICAgICB0aGlzLnNvcnRCeS5vcmRlciA9IG9yZGVyO1xuICAgICAgdGhpcy5kYXRhID0gWy4uLnRoaXMuZGF0YV07XG4gICAgfVxuICAgIGlmIChzZWFyY2gpIHtcbiAgICAgIHRoaXMudGVybSA9IEpTT04ucGFyc2Uoc2VhcmNoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGRvR3JvdXBSb3dzKCkge1xuICAgIHRoaXMuZ3JvdXBlZCA9IFtdO1xuICAgIGZyb20odGhpcy5kYXRhKS5waXBlKFxuICAgICAgZ3JvdXBCeSgocm93KSA9PiByb3dbdGhpcy5ncm91cFJvd3NCeV0pLFxuICAgICAgZmxhdE1hcCgoZ3JvdXApID0+IGdyb3VwLnBpcGUoXG4gICAgICAgIHJlZHVjZSgoYWNjOiBvYmplY3RbXSwgY3VycikgPT4gWy4uLmFjYywgY3Vycl0sIFtdKSxcbiAgICAgICkpLFxuICAgICkuc3Vic2NyaWJlKChyb3cpID0+IHRoaXMuZ3JvdXBlZC5wdXNoKHJvdykpO1xuICB9XG5cbiAgaXNSb3dDb2xsYXBzZWQocm93SW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIGlmICh0aGlzLmNvbmZpZy5jb2xsYXBzZUFsbFJvd3MpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5zZWxlY3RlZERldGFpbHNUZW1wbGF0ZVJvd0lkLmhhcyhyb3dJbmRleCk7XG4gIH1cblxuICBvbk1vdXNlRG93bihldmVudCwgdGgpIHtcbiAgICBpZiAoIXRoaXMuY29uZmlnLnJlc2l6ZUNvbHVtbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnRoID0gdGg7XG4gICAgdGhpcy5zdGFydE9mZnNldCA9IHRoLm9mZnNldFdpZHRoIC0gZXZlbnQucGFnZVg7XG4gICAgdGhpcy5lbWl0RXZlbnQoRXZlbnQub25Db2x1bW5SZXNpemVNb3VzZURvd24sIGV2ZW50KTtcbiAgfVxuXG4gIG9uTW91c2VNb3ZlKGV2ZW50KSB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5yZXNpemVDb2x1bW4pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHRoaXMudGggJiYgdGhpcy50aC5zdHlsZSkge1xuICAgICAgdGhpcy50aC5zdHlsZS53aWR0aCA9IHRoaXMuc3RhcnRPZmZzZXQgKyBldmVudC5wYWdlWCArICdweCc7XG4gICAgICB0aGlzLnRoLnN0eWxlLmN1cnNvciA9ICdjb2wtcmVzaXplJztcbiAgICAgIHRoaXMudGguc3R5bGVbJ3VzZXItc2VsZWN0J10gPSAnbm9uZSc7XG4gICAgfVxuICB9XG5cbiAgb25Nb3VzZVVwKGV2ZW50KSB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5yZXNpemVDb2x1bW4pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5lbWl0RXZlbnQoRXZlbnQub25Db2x1bW5SZXNpemVNb3VzZVVwLCBldmVudCk7XG4gICAgdGhpcy50aC5zdHlsZS5jdXJzb3IgPSAnZGVmYXVsdCc7XG4gICAgdGhpcy50aCA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIGdldCBpc0xvYWRpbmcoKTogYm9vbGVhbiB7XG4gICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFibGUnKSBhcyBIVE1MVGFibGVFbGVtZW50O1xuICAgIGlmICh0YWJsZSAmJiB0YWJsZS5yb3dzICYmIHRhYmxlLnJvd3MubGVuZ3RoID4gMykge1xuICAgICAgdGhpcy5nZXRMb2FkaW5nSGVpZ2h0KHRhYmxlLnJvd3MpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5jb25maWcuaXNMb2FkaW5nO1xuICB9XG5cbiAgZ2V0TG9hZGluZ0hlaWdodChyb3dzOiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCBzZWFyY2hFbmFibGVkID0gdGhpcy5jb25maWcuc2VhcmNoRW5hYmxlZCA/IDEgOiAwO1xuICAgIGNvbnN0IGhlYWRlckVuYWJsZWQgPSB0aGlzLmNvbmZpZy5oZWFkZXJFbmFibGVkID8gMSA6IDA7XG4gICAgY29uc3QgYm9yZGVyVHJIZWlnaHQgPSAxO1xuICAgIGNvbnN0IGJvcmRlckRpdkhlaWdodCA9IDI7XG4gICAgdGhpcy5sb2FkaW5nSGVpZ2h0ID0gKHJvd3MubGVuZ3RoIC0gc2VhcmNoRW5hYmxlZCAtIGhlYWRlckVuYWJsZWQpICogKHJvd3NbM10ub2Zmc2V0SGVpZ2h0IC0gYm9yZGVyVHJIZWlnaHQpIC0gYm9yZGVyRGl2SGVpZ2h0ICsgJ3B4JztcbiAgfVxuXG4gIGdldENvbHVtbldpZHRoKGNvbHVtbjogYW55KTogc3RyaW5nIHwgbnVsbCB7XG4gICAgaWYgKGNvbHVtbi53aWR0aCkge1xuICAgICAgcmV0dXJuIGNvbHVtbi53aWR0aDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmZpeGVkQ29sdW1uV2lkdGggPyAxMDAgLyB0aGlzLmNvbHVtbnMubGVuZ3RoICsgJyUnIDogbnVsbDtcbiAgfVxuXG4gIGdldENvbHVtbkRlZmluaXRpb24oY29sdW1uOiBDb2x1bW5zKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGNvbHVtbi5zZWFyY2hFbmFibGVkIHx8IHR5cGVvZiBjb2x1bW4uc2VhcmNoRW5hYmxlZCA9PT0gJ3VuZGVmaW5lZCc7XG4gIH1cblxuICBnZXQgYXJyb3dEZWZpbml0aW9uKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy5zaG93RGV0YWlsc0Fycm93IHx8IHR5cGVvZiB0aGlzLmNvbmZpZy5zaG93RGV0YWlsc0Fycm93ID09PSAndW5kZWZpbmVkJztcbiAgfVxuXG4gIG9uUm93Q29udGV4dE1lbnUoJGV2ZW50OiBNb3VzZUV2ZW50LCByb3c6IG9iamVjdCwga2V5OiBLZXlUeXBlLCBjb2xJbmRleDogbnVtYmVyIHwgbnVsbCwgcm93SW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgIGlmICghdGhpcy5jb25maWcuc2hvd0NvbnRleHRNZW51KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgICRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IHZhbHVlID0ge1xuICAgICAgZXZlbnQ6ICRldmVudCxcbiAgICAgIHJvdyxcbiAgICAgIGtleSxcbiAgICAgIHJvd0lkOiByb3dJbmRleCxcbiAgICAgIGNvbElkOiBjb2xJbmRleCxcbiAgICB9O1xuICAgIHRoaXMucm93Q29udGV4dE1lbnVQb3NpdGlvbiA9IHtcbiAgICAgIHRvcDogYCR7JGV2ZW50LnkgLSAxMH1weGAsXG4gICAgICBsZWZ0OiBgJHskZXZlbnQueCAtIDEwfXB4YCxcbiAgICAgIHZhbHVlLFxuICAgIH07XG5cbiAgICB0aGlzLmVtaXRFdmVudChFdmVudC5vblJvd0NvbnRleHRNZW51LCB2YWx1ZSk7XG4gIH1cblxuICBwcml2YXRlIGRvQXBwbHlEYXRhKGRhdGEpIHtcbiAgICBjb25zdCBjb2x1bW4gPSB0aGlzLmNvbHVtbnMuZmluZCgoYykgPT4gISFjLm9yZGVyQnkpO1xuICAgIGlmIChjb2x1bW4pIHtcbiAgICAgIHRoaXMuc29ydEJ5SWNvbi5vcmRlciA9IChjb2x1bW4ub3JkZXJCeSA9PT0gJ2FzYycpID8gJ2Rlc2MnIDogJ2FzYyc7XG4gICAgICB0aGlzLm9yZGVyQnkoY29sdW1uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kYXRhID0gWy4uLmRhdGEuY3VycmVudFZhbHVlXTtcbiAgICB9XG4gIH1cblxuICBvbkRyb3AoZXZlbnQ6IENka0RyYWdEcm9wPHN0cmluZ1tdPikge1xuICAgIHRoaXMuZW1pdEV2ZW50KEV2ZW50Lm9uUm93RHJvcCwgZXZlbnQpO1xuICAgIG1vdmVJdGVtSW5BcnJheSh0aGlzLmRhdGEsIGV2ZW50LnByZXZpb3VzSW5kZXgsIGV2ZW50LmN1cnJlbnRJbmRleCk7XG4gIH1cblxuICBwcml2YXRlIGJpbmRBcGkoKSB7XG4gICAgdGhpcy5hcGkuc3Vic2NyaWJlKChldmVudCkgPT4ge1xuICAgICAgc3dpdGNoIChldmVudC50eXBlKSB7XG4gICAgICAgIGNhc2UgQVBJLnJvd0NvbnRleHRNZW51Q2xpY2tlZDpcbiAgICAgICAgICB0aGlzLnJvd0NvbnRleHRNZW51UG9zaXRpb24gPSB7XG4gICAgICAgICAgICB0b3A6IG51bGwsXG4gICAgICAgICAgICBsZWZ0OiBudWxsLFxuICAgICAgICAgICAgdmFsdWU6IG51bGwsXG4gICAgICAgICAgfTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBBUEkudG9vbFBhbmVsQ2xpY2tlZDpcbiAgICAgICAgICAvLyBUT0RPXG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgY29uc29sZS53YXJuKCd1bnJlY29nbml6ZWQgQVBJIHZhbHVlJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==